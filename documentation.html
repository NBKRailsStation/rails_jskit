<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8'>
<meta content='IE=edge,chrome=1' http-equiv='X-UA-Compatible'>
<link href='http://fonts.googleapis.com/css?family=Allerta+Stencil' rel='stylesheet' type='text/css'>
<link href='/images/favicon.png' rel='icon' type='image/png'>
<title>Rails JSKit</title>
<link href="stylesheets/all.css" rel="stylesheet" type="text/css" />
</head>
<body class='documentation'>
<header id='header'><div class='navigation-wrapper'>
<a class="logo" href="https://daytonn.github.io/rails_jskit/"><img src="images/logo-white.png" />
</a><a class='navigation-menu-button' href='javascript:void(0)' id='js-mobile-menu'>MENU</a>
<nav role='navigation'>
<ul class='navigation-menu show' id='js-navigation-menu'>
<li class='nav-link'>
<a href="https://daytonn.github.io/rails_jskit/">Home</a>
</li>
<li class='nav-link'>
<a href="about.html">About</a>
</li>
<li class='nav-link'>
<a href="documentation.html">Documentation</a>
</li>
<li class='nav-link'>
<a href="https://github.com/daytonn/rails_jskit">Source</a>
</li>
</ul>
</nav>
</div>
</header>
<section id='content'>
<div class='centered'>
<h1>Guides</h1>
<div class='sidenav'>
<ul>
<li><a href="#dependencies">Dependencies</a></li>
<li>
<a href="#installation">Installation</a>
<ul>
<li><a href="#automatic-installation">Automatic Installation</a></li>
<li><a href="#manual-installation">Manual Installation</a></li>
</ul>
</li>
<li>
<a href="#getting-started">Documentation</a>
<ul>
<li>
<a href="#application-object">Application Object</a>
<ul>
<li><a href="#dispatcher">Dispatcher</a></li>
<li><a href="#controllers-object">Controllers Object</a></li>
<li><a href="#controller-factories">Controller Factories</a></li>
</ul>
</li>
<li>
<a href="#controllers">Controllers</a>
<ul>
<li><a href="#actions">Actions</a></li>
<li><a href="#mapped-actions">Mapped Actions</a></li>
<li><a href="#all-action">The <code>all</code> Action</a></li>
<li><a href="#application-controller">Creating an Application Controller</a></li>
<li><a href="#passing-data">Passing Data To Actions</a></li>
<li><a href="#elements">Elements</a></li>
<li><a href="#events">Events</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#configuration">Configuration</a></li>
<li>
<a href="#getting-started">Testing</a>
<ul>
<li><a href="#controller-factories">Controller Factories</a></li>
<li><a href="#testing-actions">Testing Actions</a></li>
<li><a href="#testing-elements">Testing Elements</a></li>
<li><a href="#testing-events">Testing Events</a></li>
</ul>
</li>
</ul>
</div>
<div class='content'>
<h2 id='dependencies'>Dependencies</h2>
<p>RailsJskit requires <code>jquery</code> (or equivalent) and <code>lodash</code> (or equivalent). Require them in your <code>app/assets/javascripts/application.js</code> before <code>//= require rails_jskit</code>.</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascripts/application.js</span>&#x000A;<span class="c1">//= require lodash</span>&#x000A;<span class="c1">//= require jquery</span>&#x000A;&#x000A;</code></pre>
<h2 id='installation'>Installation</h2>
<p>Add `rails_jskit` to your Gemfile:</p>
<pre class="highlight ruby"><code>&#x000A;<span class="c1"># Gemfile</span>&#x000A;<span class="n">gem</span> <span class="s2">"rails_jskit"</span>&#x000A;&#x000A;</code></pre>
<p>Bundle it up</p>
<pre class="highlight shell"><code>&#x000A;bundle install&#x000A;&#x000A;</code></pre>
<h3 id='automatic-installation'>Automatic Installation</h3>
<p>RailsJskit comes with handy generators to get you started quickly. Use the generator to install jskit:</p>
<pre class="highlight shell"><code>&#x000A;rails generate jskit:install&#x000A;&#x000A;</code></pre>
<p>Or you can install it the good old-fashioned way, by hand:</p>
<h3 id='manual-installation'>Manual Installation</h3>
<p>Create a <code>app/assets/javascripts/controllers/</code> directory and add rails_jskit to <code>app/assets/javascripts/application.js</code>:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascripts/application.js</span>&#x000A;<span class="p">...</span>&#x000A;<span class="c1">//= require rails_jskit</span>&#x000A;<span class="c1">//= require_tree ./controllers</span>&#x000A;&#x000A;</code></pre>
<p>Add <code>jskit</code> to your application layout:</p>
<pre class="highlight erb"><code>&#x000A;# app/views/layouts/application.html.erb&#x000A;<span class="cp">&lt;!DOCTYPE html&gt;</span>&#x000A;<span class="nt">&lt;html&gt;</span>&#x000A;<span class="nt">&lt;head&gt;</span>&#x000A;  <span class="nt">&lt;title&gt;</span>JskitExample<span class="nt">&lt;/title&gt;</span>&#x000A;  <span class="cp">&lt;%=</span> <span class="n">stylesheet_link_tag</span> <span class="s1">'application'</span><span class="p">,</span> <span class="ss">media: </span><span class="s1">'all'</span> <span class="cp">%&gt;</span>&#x000A;  <span class="cp">&lt;%=</span> <span class="n">csrf_meta_tags</span> <span class="cp">%&gt;</span>&#x000A;<span class="nt">&lt;/head&gt;</span>&#x000A;<span class="nt">&lt;body&gt;</span>&#x000A;  <span class="cp">&lt;%=</span> <span class="k">yield</span> <span class="cp">%&gt;</span>&#x000A;  <span class="cp">&lt;%=</span> <span class="n">javascript_include_tag</span> <span class="s1">'application'</span> <span class="cp">%&gt;</span>&#x000A;  <span class="cp">&lt;%=</span> <span class="n">jskit</span> <span class="cp">%&gt;</span>&#x000A;<span class="nt">&lt;/body&gt;</span>&#x000A;<span class="nt">&lt;/html&gt;</span>&#x000A;&#x000A;&#x000A;</code></pre>
<p>
<strong>That's it!</strong>
You're ready to use RailsJskit.
</p>
<p>Now all your controllers will be loaded at runtime but nothing will execute until events are dispatched.</p>
<h2 id='getting-started'>Documentation</h2>
<h3 id='application-object'>Application Object</h3>
<p>RailsJskit will automatically create a JSkit application object for you, using the configured <code>app_namespace</code> for the global variable name <em>(defaults to "App")</em>. This global namespace provides you a way to interact with your JSkit application. You can <a href="#configuration">configure</a> this setting in your initializer <code>(config/initializers/rails_jskit.rb)</code>.</p>
<h4 id='dispatcher'>Dispatcher</h4>
<p>Every JSkit application has a <code>Dispatcher</code> object. This object is responsible for registering and triggering events in your application. In general you don't interact directly with the application's Dispatcher, though it's important to know what it is and what it's doing. By default, every controller created by your application will have it's own reference to the Dispatcher object. A controller's actions will automatically be registered on the Dispatcher when it's created, so you shouldn't need to interact with the Dispatcher directly.</p>
<h4 id='controllers-object'>Controllers Object</h4>
<p>Every JSkit application also has a <code>Controllers</code> object that stores the Controllers instantiated by your application at runtime. Everytime you create a controller, an instance is created on the controllers object:</p>
<pre class="highlight ruby"><code>&#x000A;<span class="sr">//</span> <span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">javascripts</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">js</span>&#x000A;<span class="no">App</span><span class="p">.</span><span class="nf">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="p">.</span><span class="nf">.</span><span class="o">.</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;<span class="no">App</span><span class="o">.</span><span class="no">Controllers</span><span class="o">.</span><span class="no">Posts</span><span class="p">;</span><span class="sr">//</span> <span class="no">Instantiated</span> <span class="no">Posts</span> <span class="n">controller</span> <span class="n">object</span>&#x000A;&#x000A;</code></pre>
<h4 id='controller-factories'>Controller Factories</h4>
<p>In addition to instances of each controller, the factory used to create the controller is stored on the application object itself. The factory is a function that will create a freshly initialized controller, useful in testing environments:</p>
<pre class="highlight ruby"><code>&#x000A;<span class="sr">//</span> <span class="n">app</span><span class="o">/</span><span class="n">assets</span><span class="o">/</span><span class="n">javascripts</span><span class="o">/</span><span class="n">controllers</span><span class="o">/</span><span class="n">posts_controller</span><span class="p">.</span><span class="nf">js</span>&#x000A;<span class="no">App</span><span class="p">.</span><span class="nf">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="p">.</span><span class="nf">.</span><span class="o">.</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;<span class="no">App</span><span class="o">.</span><span class="no">PostsController</span><span class="p">;</span><span class="sr">//</span> <span class="no">Factory</span> <span class="n">function</span> <span class="n">to</span> <span class="n">create</span> <span class="n">fresh</span> <span class="no">Posts</span> <span class="n">controller</span> <span class="n">objects</span>&#x000A;&#x000A;</code></pre>
<h3 id='controllers'>Controllers</h3>
<p>The basic component of JSkit is the Controller. Controllers allow you to coordinate JavaScript execution with your Rails controllers. For example, assuming you have a <code>PostsController</code> in <code>app/controllers/posts_controller.rb</code>.</p>
<pre class="highlight ruby"><code>&#x000A;<span class="c1"># app/controllers/posts_controller.rb</span>&#x000A;<span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="k">def</span> <span class="nf">index</span>&#x000A;    <span class="n">render</span> <span class="ss">:index</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;</code></pre>
<h4 id='actions'>Actions</h4>
<p>To define JavaScript for that controller, create a corresponding JSkit controller in <code>app/assets/javascripts/controllers/posts_controller.js</code> and define it's <code>actions</code>. The actions array tells JSkit which functions you want automatically wired to the controller's events. If you wish to run javascript on the <code>index</code> action of the <code>PostsController</code>, it would look something like this:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascripts/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">actions</span><span class="p">:</span> <span class="p">[</span><span class="s2">"index"</span><span class="p">]</span>&#x000A;&#x000A;  <span class="na">index</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="c1">// behavior for posts#index</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;&#x000A;</code></pre>
<p>Now whenever your <code>PostsController</code> renders the <code>index</code> action, the JSkit controller's index method will execute. It's that simple.</p>
<h4 id='mapped-actions'>Mapped Actions</h4>
<p>You may find yourself wanting to wire up an action with a different function name than it's corresponding rails controlller, or you may want to assign the same function to multiple actions. This can be acheived by using a mapped action:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascripts/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">actions</span><span class="p">:</span> <span class="p">[{</span>&#x000A;    <span class="na">edit</span><span class="p">:</span> <span class="s2">"setupForm"</span><span class="p">,</span>&#x000A;    <span class="na">create</span><span class="p">:</span> <span class="s2">"setupForm"</span><span class="p">,</span>&#x000A;    <span class="na">update</span><span class="p">:</span> <span class="s2">"setupform"</span>&#x000A;  <span class="p">}],</span>&#x000A;&#x000A;  <span class="p">...</span>&#x000A;  <span class="na">setupForm</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="c1">// form setup</span>&#x000A;  <span class="p">}</span>&#x000A;  <span class="p">...</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>This will wire the three events <code>controllers:posts:edit</code>, <code>controllers:posts:create</code>, and <code>controllers:posts:upate</code> to the <code>setupForm</code> function.</p>
<p>This simple convention is flexible enough to accomplish any sane JavaScript task for a given action.</p>
<p class='note'><em>Note: you can mix and match objects and strings within the actions array but it's probably best to define the string actions first and pass an object as the last item in the array. This is only for readability as JSkit does not care about the position of the actions in the array.</em></p>
<pre class="highlight javascript"><code>&#x000A;<span class="p">...</span>&#x000A;<span class="nl">actions</span><span class="p">:</span> <span class="p">[</span>&#x000A;  <span class="s2">"index"</span><span class="p">,</span>&#x000A;  <span class="s2">"show"</span><span class="p">,</span>&#x000A;  <span class="p">{</span>&#x000A;    <span class="na">edit</span><span class="p">:</span> <span class="s2">"setupForm"</span><span class="p">,</span>&#x000A;    <span class="na">create</span><span class="p">:</span> <span class="s2">"setupForm"</span><span class="p">,</span>&#x000A;    <span class="na">update</span><span class="p">:</span> <span class="s2">"setupForm"</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">]</span>&#x000A;&#x000A;</code></pre>
<h4 id='all-action'>The <code>all</code> action</h4>
<p>There are times when you want a bit of JavaScript to run for every action of a given controller. In this case you can define an <code>all</code> method on the controller which will automatically be triggered on every action of the controller:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="p">...</span>&#x000A;<span class="nl">all</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;  <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">"Happens on every action"</span><span class="p">);</span>&#x000A;<span class="p">}</span>&#x000A;<span class="p">...</span>&#x000A;&#x000A;</code></pre>
<p class='note'><em>Note: you don't have to add <code>all</code> to the actions array, JSkit knows what you mean.</em></p>
<h4 id='application-controller'>Creating an Application Controller</h4>
<p>In some cases, you may want some JavaScript to run on every single page of your application. Something like fading out flash notifications, or instantiating dynamic menus or something of that nature. In this case you can create an Application Controller at: <code>app/assets/javscripts/controllers/application_controller.js</code></p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javscripts/controllers/application</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Application"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">all</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="nx">$</span><span class="p">(</span><span class="s2">"#notifications"</span><span class="p">).</span><span class="nx">fadeOut</span><span class="p">();</span>&#x000A;    <span class="p">},</span> <span class="mi">3000</span><span class="p">);</span>&#x000A;&#x000A;    <span class="nx">$</span><span class="p">(</span><span class="s2">"#menu"</span><span class="p">).</span><span class="nx">menuify</span><span class="p">();</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>There is nothing special about this controller except the fact that RailsJskit will trigger the <code>controller:application:all</code> event on every action of every controller. Which means that the <code>all</code> method will execute on every page.</p>
<h4 id='passing-data'>Passing Data To Actions</h4>
<p>Sometimes you may find yourself wanting to pass data from the Rails side of your application to the client side. The JSkit event system accounts for this and RailsJskit provides a simple interface to this functionality. JSkit has three payload methods, which are available to your application's controllers. The three methods correspond to the three levels of triggered events on any given page.</p>
<ol>
<li><code>set_app_payload</code> (sent with "controllers:application:all")</li>
<li><code>set_controller_payload</code> (sent with "controllers:[controller name]:[action name]")</li>
<li><code>set_action_payload</code> (sent with "controllers:[controller name][action name]")</li>
</ol>
<p>Let's assume you want to pass devise's <code>current_user</code> object to the application controller. For this you would use <code>app_payload</code></p>
<pre class="highlight ruby"><code>&#x000A;<span class="c1"># app/controllers/application_controller.rb</span>&#x000A;<span class="k">class</span> <span class="nc">ApplicationController</span> <span class="o">&lt;</span> <span class="no">ActionController</span><span class="o">::</span><span class="no">Base</span>&#x000A;  <span class="n">before_action</span> <span class="ss">:jskit_app_payload</span>&#x000A;&#x000A;  <span class="kp">private</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">jskit_app_payload</span>&#x000A;    <span class="n">set_app_payload</span><span class="p">(</span><span class="n">current_user</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;</code></pre>
<p>This will pass the <code>current_user</code> as JSON in the <code>controllers:application:all</code> event:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">Dispatcher</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">"controller:application:all"</span><span class="p">,</span> <span class="p">{</span> <span class="na">email</span><span class="p">:</span> <span class="s2">"user@example.com"</span><span class="p">,</span> <span class="na">first_name</span><span class="p">:</span> <span class="s2">"John"</span><span class="p">,</span> <span class="na">last_name</span><span class="p">:</span> <span class="s2">"Smith"</span><span class="p">...</span> <span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>Your application controller can make use of this data by assigning the argument to the action function:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascripts/controllers/application_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Application"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">all</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">currentUser</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="nx">App</span><span class="p">.</span><span class="nx">currentUser</span> <span class="o">=</span> <span class="nx">currentUser</span><span class="p">;</span><span class="c1">// { email: "user@example.com", first_name: "John", last_name: "Smith"... }</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>These payload methods will take any number of arguments and pass them in order to the event handler. This allows for a simple but flexible way to pass data to your client-side application.</p>
<p>The <code>set_controller_payload</code> method and the <code>set_action_payload</code> work in the same way only they pass data to their specific events.</p>
<pre class="highlight ruby"><code>&#x000A;<span class="c1"># app/controllers/posts_controller.rb</span>&#x000A;<span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>&#x000A;  <span class="n">before_action</span> <span class="ss">:jskit_controller_payload</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">index</span>&#x000A;    <span class="n">set_action_payload</span><span class="p">(</span><span class="s2">"Data from the PostsController#index action"</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;&#x000A;  <span class="kp">private</span> <span class="n">jskit_controller_payload</span>&#x000A;&#x000A;  <span class="k">def</span> <span class="nf">jskit_controller_payload</span>&#x000A;    <span class="n">set_controller_payload</span><span class="p">(</span><span class="s2">"Data from the PostsController"</span><span class="p">)</span>&#x000A;  <span class="k">end</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;</code></pre>
<p>This data can be accessed in the JSkit controller like so:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascript/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">actions</span><span class="p">:</span> <span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>&#x000A;&#x000A;  <span class="na">all</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span><span class="c1">// "Data from the PostsController"</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">index</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">message</span><span class="p">);</span><span class="c1">// "Data from the PostsController#index action"</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<h4 id='elements'>Elements</h4>
<p>It's guaranteed you'll end up saving a reference to an <code>HTMLElement</code> wrapped in <code>jQuery</code> <em>(the proverbial jQuery burrito)</em>. You do this so often, it really helps to have a shorthand for doing so. Consider the following code:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">actions</span><span class="p">:</span> <span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>&#x000A;&#x000A;  <span class="na">cacheElements</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$postList</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"ul#posts"</span><span class="p">);</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$commentToggleLink</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"a.comment-toggle"</span><span class="p">);</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$modalWindow</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-window"</span><span class="p">);</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$modalCloseButton</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#modal-window-close"</span><span class="p">);</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">index</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">cacheElements</span><span class="p">();</span>&#x000A;    <span class="c1">// do stuff with elements</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>This is generally pretty clean code. It's easy to read and it's simple. The problem is that we're going to want to do the same thing in other actions. We can use the same <code>cacheElements</code> method but we may not need all the selectors.</p>
<p>If we do want to scope elements to actions, we'll need a way to scope the selected elements to specific actions. JSkit allows you to define this behavior with a simple <code>elements</code> object on the controller. Which looks something like this:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">elements</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">postList</span><span class="p">:</span> <span class="s2">"ul#posts"</span><span class="p">,</span>&#x000A;      <span class="na">commentToggleLink</span><span class="p">:</span> <span class="s2">"a.comment-toggle"</span><span class="p">,</span>&#x000A;      <span class="na">modalWindow</span><span class="p">:</span> <span class="s2">"#modal-window"</span><span class="p">,</span>&#x000A;      <span class="na">modalCloseButton</span><span class="p">:</span> <span class="s2">"#modal-window-close"</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">index</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="c1">// do stuff with elements</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>This keeps all the DOM selection one simple structure that cuts down on the clutter.</p>
<p class='note'><em>Note: all keys under each action will be set as variables prefixed with the <code>$</code> to indicate that it's a <code>jQuery</code> wrapped set.</em> The above example would create three variables on the controller object when the <code>index</code> action is triggered:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">elements</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">postList</span><span class="p">:</span> <span class="s2">"ul#posts"</span><span class="p">,</span>&#x000A;      <span class="na">commentToggleLink</span><span class="p">:</span> <span class="s2">"a.comment-toggle"</span><span class="p">,</span>&#x000A;      <span class="na">modalWindow</span><span class="p">:</span> <span class="s2">"#modal-window"</span><span class="p">,</span>&#x000A;      <span class="na">modalCloseButton</span><span class="p">:</span> <span class="s2">"#modal-window-close"</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">index</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$postList</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$commentToggleLink</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$modalWindow</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$modalCloseButton</span><span class="p">;</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<h4 id='events'>Events</h4>
<p>Another common piece of boilerplate code is registering for events on <code>jQuery</code> wrapped elements. You know, the meat and potatoes of js development. JSkit has a novel way of tidying up event registration as well. An action's elements can be wired up to event handler functions (defined on the controller) in a similar fashion to selecting the elements, with the events object:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">elements</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">launchModalButton</span><span class="p">:</span> <span class="s2">"#launch-modal"</span><span class="p">,</span>&#x000A;      <span class="na">modalCloseButton</span><span class="p">:</span> <span class="s2">"#modal-window-close"</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">launchModalButton</span><span class="p">:</span> <span class="p">{</span> <span class="na">click</span><span class="p">:</span> <span class="s2">"openModalWindow"</span> <span class="p">},</span>&#x000A;      <span class="na">modalCloseButton</span><span class="p">:</span> <span class="p">{</span> <span class="na">click</span><span class="p">:</span> <span class="s2">"closeModalWindow"</span> <span class="p">}</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">openModalWindow</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$modalWindow</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">"hidden"</span><span class="p">);</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">closeModalWindow</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$modalWindow</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">"hidden"</span><span class="p">);</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>You may recognize this pattern from other frameworks. While JSkit aims to be a small, simple alternative to large frameworks, this is a simple way reduce some of the repetetive code in your everyday JavaScript. It's also tested in JSkit itself, so you don't need to test that the events were registered properly.</p>
<p class='note'><em>Note: if you are not doing anything else in an action but wiring elements and events, you can skip adding it to the <code>actions</code> array, and creating a function for that action.</em></p>
<h5 id='multiple-events'>Multiple Events</h5>
<p>It is also possible to register multiple events on a given element, to do so simply add event keys to the event object for the given action:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javscripts/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">elements</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">nameField</span><span class="p">:</span> <span class="s2">"input#name"</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">nameField</span><span class="p">:</span> <span class="p">{</span>&#x000A;        <span class="na">change</span><span class="p">:</span> <span class="s2">"handleNameFieldChange"</span><span class="p">,</span>&#x000A;        <span class="na">keyup</span><span class="p">:</span> <span class="s2">"handleNameFieldKeyup"</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">handleNameFieldChange</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evnt</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="c1">// handle name field change</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">handleNameFieldKeyup</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">evnt</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="c1">// handle name field keyup</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<h2 id='configuration'>Configuration</h2>
<p>At this point, RailsJskit only has one setting, the <code>app_namespace</code>. If you're fine with the default namespace of "App", you don't need to change it. Otherwise create an initializer:</p>
<pre class="highlight ruby"><code>&#x000A;<span class="c1"># config/initializers/rails_jskit.rb</span>&#x000A;<span class="no">RailsJskit</span><span class="p">.</span><span class="nf">configure</span> <span class="k">do</span> <span class="o">|</span><span class="n">config</span><span class="o">|</span>&#x000A;  <span class="n">config</span><span class="p">.</span><span class="nf">app_namespace</span> <span class="o">=</span> <span class="s2">"MyApp"</span>&#x000A;<span class="k">end</span>&#x000A;&#x000A;</code></pre>
<p>Now you can refer to your application globally as <code>MyApp</code>.</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javascripts/controllers/application_controller.js</span>&#x000A;<span class="nx">MyApp</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{...});</span>&#x000A;&#x000A;</code></pre>
<h2 id='testing'>Testing</h2>
<p>One of the main advantages of RailsJSkit is that it provides a simple structure that's easily tested. There are however, a few things you need to keep in mind while testing JSkit controllers.</p>
<p>When testing, it's important to use the <a href="#controller-factories">Controller Factories</a> to create your test subjects. This ensures that you always have a fresh version of the controller that has not been mutated by previous tests. A basic jasmine/mocha style JSkit controller test looks something like this:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// spec/javscripts/controllers/posts_controller_spec.js</span>&#x000A;<span class="nx">describe</span><span class="p">(</span><span class="s2">"PostsController"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;  <span class="kd">var</span> <span class="nx">subject</span><span class="p">;</span>&#x000A;  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">subject</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">PostsController</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span><span class="c1">// creates a fresh controller</span>&#x000A;  <span class="p">});</span>&#x000A;&#x000A;  <span class="nx">describe</span><span class="p">(</span><span class="s2">"#index"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">it</span><span class="p">(</span><span class="s2">"has tests"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="nx">expect</span><span class="p">(</span><span class="kc">true</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>&#x000A;    <span class="p">});</span>&#x000A;  <span class="p">});</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<h3 id='testing-actions'>Testing Actions</h3>
<p>Testing actions is straight-forward, since they are just functions on your controller object, you can simply call them and test their behavior:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javscripts/controller/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">actions</span><span class="p">:</span> <span class="p">[</span><span class="s2">"index"</span><span class="p">],</span>&#x000A;&#x000A;  <span class="na">elements</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">pageContainer</span><span class="p">:</span> <span class="s2">"#container"</span><span class="p">,</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">index</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">color</span><span class="p">)</span> <span class="p">{</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">color</span> <span class="o">=</span> <span class="nx">color</span><span class="p">;</span>&#x000A;    <span class="k">this</span><span class="p">.</span><span class="nx">$pageContainer</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">color</span><span class="p">);</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// spec/javscripts/controllers/posts_controller_spec.js</span>&#x000A;<span class="nx">describe</span><span class="p">(</span><span class="s2">"PostsController"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;  <span class="kd">var</span> <span class="nx">subject</span><span class="p">;</span>&#x000A;  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">subject</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">PostsController</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>&#x000A;  <span class="p">});</span>&#x000A;&#x000A;  <span class="nx">describe</span><span class="p">(</span><span class="s2">"#index"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">it</span><span class="p">(</span><span class="s2">"sets the color variable with the given value"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="nx">subject</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="s2">"#FF0000"</span><span class="p">);</span>&#x000A;      <span class="nx">expect</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">color</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s2">"#FF0000"</span><span class="p">);</span>&#x000A;    <span class="p">});</span>&#x000A;&#x000A;    <span class="nx">it</span><span class="p">(</span><span class="s2">"changes the page background color to the given color"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="nx">subject</span><span class="p">.</span><span class="nx">index</span><span class="p">(</span><span class="s2">"#FF0000"</span><span class="p">);</span>&#x000A;      <span class="nx">expect</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">$pageContainer</span><span class="p">.</span><span class="nx">css</span><span class="p">(</span><span class="s2">"background-color"</span><span class="p">)).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s2">"#FF0000"</span><span class="p">);</span>&#x000A;    <span class="p">});</span>&#x000A;  <span class="p">});</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<p>Obviously this is a contrived example but you can see that testing an action is as simple as testing a function.</p>
<h3 id='testing-elements'>Testing Elements</h3>
<p>While you don't have to test the functionality of JSkit itself, you may want to assert that a certain action has access to a given element. To do this we can simply test the values in the elements object, without having to add fixtures to the test DOM:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// spec/javscripts/controllers/posts_controller_spec.js</span>&#x000A;<span class="nx">describe</span><span class="p">(</span><span class="s2">"PostsController"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;  <span class="kd">var</span> <span class="nx">subject</span><span class="p">;</span>&#x000A;  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">subject</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">PostsController</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>&#x000A;  <span class="p">});</span>&#x000A;&#x000A;  <span class="nx">describe</span><span class="p">(</span><span class="s2">"#index"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">describe</span><span class="p">(</span><span class="s2">"elements"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="nx">it</span><span class="p">(</span><span class="s2">"saves a reference to the #container element"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="nx">expect</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">elements</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">pageContainer</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s2">"#container"</span><span class="p">);</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">});</span>&#x000A;  <span class="p">});</span>&#x000A;<span class="p">});</span>&#x000A;&#x000A;</code></pre>
<h3 id='testing-events'>Testing Events</h3>
<p>Testing events is just as easy as testing elements, since they have a similar object:</p>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// app/assets/javscripts/controllers/posts_controller.js</span>&#x000A;<span class="nx">App</span><span class="p">.</span><span class="nx">createController</span><span class="p">(</span><span class="s2">"Posts"</span><span class="p">,</span> <span class="p">{</span>&#x000A;  <span class="na">elements</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">expandCommentsButton</span><span class="p">:</span> <span class="s2">"#expand-comments"</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">events</span><span class="p">:</span> <span class="p">{</span>&#x000A;    <span class="na">index</span><span class="p">:</span> <span class="p">{</span>&#x000A;      <span class="na">expandCommentsButton</span><span class="p">:</span> <span class="p">{</span>&#x000A;        <span class="na">click</span><span class="p">:</span> <span class="s2">"handleExpandCommentsClick"</span>&#x000A;      <span class="p">}</span>&#x000A;    <span class="p">}</span>&#x000A;  <span class="p">},</span>&#x000A;&#x000A;  <span class="na">handleExpandCommentsClick</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="p">...</span>&#x000A;  <span class="p">}</span>&#x000A;<span class="p">});</span>&#x000A;</code></pre>
<pre class="highlight javascript"><code>&#x000A;<span class="c1">// spec/javscripts/controllers/posts_controller_spec.js</span>&#x000A;<span class="nx">describe</span><span class="p">(</span><span class="s2">"PostsController"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;  <span class="kd">var</span> <span class="nx">subject</span><span class="p">;</span>&#x000A;  <span class="nx">beforeEach</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">subject</span> <span class="o">=</span> <span class="nx">App</span><span class="p">.</span><span class="nx">PostsController</span><span class="p">.</span><span class="nx">create</span><span class="p">();</span>&#x000A;  <span class="p">});</span>&#x000A;&#x000A;  <span class="nx">describe</span><span class="p">(</span><span class="s2">"#index"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;    <span class="nx">describe</span><span class="p">(</span><span class="s2">"events"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;      <span class="nx">it</span><span class="p">(</span><span class="s2">"wires up `handleExpandCommentsClick` on click of the $expandCommentsButton"</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>&#x000A;        <span class="nx">expect</span><span class="p">(</span><span class="nx">subject</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">index</span><span class="p">.</span><span class="nx">expandCommentsButton</span><span class="p">.</span><span class="nx">click</span><span class="p">).</span><span class="nx">to</span><span class="p">.</span><span class="nx">equal</span><span class="p">(</span><span class="s2">"handleExpandCommentsClick"</span><span class="p">);</span>&#x000A;      <span class="p">});</span>&#x000A;    <span class="p">});</span>&#x000A;  <span class="p">});</span>&#x000A;<span class="p">});</span>&#x000A;</code></pre>
</div>

</div>
</section>
<footer id='footer'>
<div class='centered'></div>
</footer>
<script src="javascripts/all.js" type="text/javascript"></script>
</body>
</html>
